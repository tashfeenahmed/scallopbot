---
phase: 07-agent-loop-refactor
plan: 01
type: execute
---

<objective>
Update agent system prompt to reference skills instead of hardcoded tools.

Purpose: The current DEFAULT_SYSTEM_PROMPT explicitly lists tool names (bash, read, write, etc.) which will be replaced by skills. This plan updates the prompt to be skills-aware while maintaining the same behavioral guidance.
Output: Updated system prompt that references skills dynamically, enhanced skill prompt generation with input schemas.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Prior phase summaries (dependency graph)
@.planning/phases/01-skill-system-foundation/01-01-SUMMARY.md
@.planning/phases/03-skill-executor/03-01-SUMMARY.md
@.planning/phases/06-telegram-memory-skills/06-02-SUMMARY.md

# Source files
@src/agent/agent.ts
@src/skills/registry.ts
@src/skills/types.ts

**Tech stack available:** SkillRegistry, SkillExecutor, Skill interface with frontmatter
**Established patterns:** Skills have name, description, triggers, scripts mapping in frontmatter
**Constraining decisions:**
- Skills generate their own prompt via generateSkillPrompt()
- SKILL_ARGS env var for passing arguments as JSON
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update DEFAULT_SYSTEM_PROMPT to be skills-oriented</name>
  <files>src/agent/agent.ts</files>
  <action>
Replace the hardcoded tool list in DEFAULT_SYSTEM_PROMPT with a generic reference to available skills. The prompt should:

1. Remove the explicit tool list (send_message, web_search, bash, read, write, etc.)
2. Add text indicating skills are listed below the system prompt
3. Keep all behavioral guidance (reminders, memory, research rules, formatting, etc.)
4. Update "USE tools" language to "USE skills"

Key changes:
- "Available tools:" section → "You have access to skills listed at the end of this prompt"
- "USE tools immediately" → "USE skills immediately"
- Keep REMINDERS, MEMORY, RESEARCH sections as-is (they provide behavioral context)
- Remove hardcoded tool descriptions - skills will provide their own descriptions

Do NOT remove the behavioral sections (REMINDERS, AUTOMATIC MEMORY, etc.) - these are still valuable guidance.
  </action>
  <verify>grep -c "skill" src/agent/agent.ts shows increased mentions, no hardcoded tool list remains</verify>
  <done>DEFAULT_SYSTEM_PROMPT references skills generically, no hardcoded tool names, behavioral guidance preserved</done>
</task>

<task type="auto">
  <name>Task 2: Enhance generateSkillPrompt() with input schemas</name>
  <files>src/skills/registry.ts, src/skills/types.ts</files>
  <action>
Update SkillRegistry.generateSkillPrompt() to include input parameter documentation for each skill.

1. In types.ts, add optional `inputSchema` to SkillFrontmatter:
   ```typescript
   inputSchema?: {
     type: 'object';
     properties: Record<string, { type: string; description?: string }>;
     required?: string[];
   };
   ```

2. In registry.ts, update generateSkillPrompt() to:
   - Include input parameters for each skill (if inputSchema exists in frontmatter)
   - Format as "Parameters: param1 (type) - description, param2 (type) - description"
   - Keep the format concise - this goes into every LLM call

Example output format:
```
# Available Skills

- **bash**: Execute shell commands in the workspace directory
  Parameters: command (string) - The command to execute, timeout (number, optional) - Timeout in ms, cwd (string, optional) - Working directory

- **web_search**: Search the web using Brave Search API
  Parameters: query (string) - Search query, count (number, optional) - Number of results
```

Do NOT change the skill invocation logic - that's in 07-02.
  </action>
  <verify>npm run build succeeds, generateSkillPrompt() includes parameter info for skills that have inputSchema</verify>
  <done>SkillFrontmatter has inputSchema field, generateSkillPrompt() includes parameter documentation</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] DEFAULT_SYSTEM_PROMPT no longer has hardcoded tool names
- [ ] generateSkillPrompt() produces readable skill descriptions with parameters
- [ ] No TypeScript errors
</verification>

<success_criteria>

- System prompt updated to reference skills dynamically
- Skill prompt includes input parameters for documented skills
- All verification checks pass
- Build succeeds
</success_criteria>

<output>
After completion, create `.planning/phases/07-agent-loop-refactor/07-01-SUMMARY.md`
</output>
