# Codebase Structure

**Analysis Date:** 2026-02-04

## Directory Layout

```
smartbot/
├── src/                    # Source code (111 files)
│   ├── index.ts           # Library entry point
│   ├── cli.ts             # CLI entry point
│   ├── agent/             # Agent orchestration
│   ├── channels/          # Platform adapters
│   ├── config/            # Configuration
│   ├── gateway/           # Central orchestrator
│   ├── routing/           # Provider selection
│   ├── tools/             # Tool implementations
│   ├── memory/            # Persistent memory
│   ├── providers/         # LLM backends
│   ├── skills/            # Skill system
│   ├── media/             # Media processing
│   ├── voice/             # Speech I/O
│   ├── scheduler/         # Task scheduling
│   ├── e2e/               # End-to-end WebSocket tests
│   ├── cache/             # Caching layer
│   ├── reliability/       # Resilience patterns
│   └── utils/             # Utilities
├── dist/                   # Compiled JavaScript
├── specs/                  # Specification docs
├── scripts/                # Utility scripts
├── sessions/               # Session data (gitignored)
├── assets/                 # Static assets
└── .planning/              # GSD planning files
```

## Directory Purposes

**src/agent/** (5 files):
- Purpose: Agent orchestration and session management
- Contains: `agent.ts`, `session.ts`, `recovery.ts`, `style.ts`
- Key files: `agent.ts` - Main agentic loop with tool execution

**src/channels/** (10 files):
- Purpose: Platform-specific communication adapters
- Contains: Telegram, Discord, CLI, Slack, WhatsApp, Matrix, Signal, API
- Key files: `telegram.ts` (1088 lines), `discord.ts`

**src/config/** (3 files):
- Purpose: Configuration management with Zod validation
- Contains: Schema definitions, env loading
- Key files: `config.ts` (310 lines)

**src/gateway/** (2 files):
- Purpose: Central orchestrator initializing all subsystems
- Contains: Gateway class
- Key files: `gateway.ts`

**src/routing/** (5 files):
- Purpose: Smart provider selection and cost management
- Contains: Router, complexity analyzer, cost tracker, context manager
- Key files: `router.ts`, `cost.ts`, `complexity.ts`

**src/tools/** (16 files):
- Purpose: Executable tools for agent
- Contains: bash, read, write, edit, browser, search, memory, reminder, voice
- Key files: `registry.ts`, `bash.ts`, `browser/`

**src/memory/** (17 files):
- Purpose: Persistent semantic memory system
- Contains: SQLite store, embeddings, fact extraction, relations
- Key files: `memory.ts` (1513 lines), `db.ts` (808 lines), `scallop-store.ts`

**src/providers/** (10 files):
- Purpose: LLM provider implementations
- Contains: Anthropic, OpenAI, Groq, Ollama, OpenRouter, Moonshot, xAI
- Key files: `anthropic.ts`, `types.ts`, `registry.ts`

**src/skills/** (14 files):
- Purpose: Dynamic skill system
- Contains: Registry, loader, parser, SDK, bundled skills
- Key files: `registry.ts`, `loader.ts`, `clawhub.ts`

**src/voice/** (9 files):
- Purpose: Speech-to-text and text-to-speech
- Contains: STT (Whisper, Groq, macOS), TTS (Piper, OpenAI, macOS)
- Key files: `stt/cloud/openai.ts`, `tts/local/piper.ts`

## Key File Locations

**Entry Points:**
- `src/index.ts` - Library export
- `src/cli.ts` - CLI commands (start, chat)

**Configuration:**
- `tsconfig.json` - TypeScript config
- `vitest.config.ts` - Test config
- `eslint.config.js` - Linting rules
- `.env.example` - Environment template
- `ecosystem.config.cjs` - PM2 config

**Core Logic:**
- `src/agent/agent.ts` - Agentic processing loop
- `src/gateway/gateway.ts` - System initialization
- `src/routing/router.ts` - Provider selection
- `src/memory/memory.ts` - Memory system

**Testing:**
- `src/**/*.test.ts` - Co-located unit tests (44 files)
- `src/e2e/` - End-to-end WebSocket integration tests
- `vitest.config.ts` - Test configuration

## Naming Conventions

**Files:**
- kebab-case for all files: `fact-extractor.ts`, `scallop-store.ts`
- `.test.ts` suffix for tests alongside source
- `index.ts` for barrel exports

**Directories:**
- Lowercase, kebab-case: `src/tools/`, `src/memory/`
- Plural for collections: `providers/`, `channels/`, `tools/`

**Special Patterns:**
- `types.ts` for interface definitions
- `registry.ts` for registries
- `index.ts` re-exports public API

## Where to Add New Code

**New LLM Provider:**
- Implementation: `src/providers/{name}.ts`
- Types: `src/providers/types.ts`
- Register in: `src/providers/registry.ts`

**New Tool:**
- Implementation: `src/tools/{name}.ts`
- Types: `src/tools/types.ts`
- Register in: `src/tools/registry.ts`

**New Channel:**
- Implementation: `src/channels/{name}.ts`
- Types: `src/channels/types.ts`
- Enable in: `src/config/config.ts`

**New Feature:**
- Primary code: `src/{feature}/`
- Tests: `src/{feature}/*.test.ts`
- Export from: `src/{feature}/index.ts`

## Special Directories

**dist/**:
- Purpose: Compiled JavaScript output
- Source: Generated by `tsc`
- Committed: No (in .gitignore)

**sessions/**:
- Purpose: Session JSONL files
- Source: Created at runtime
- Committed: No (in .gitignore)

**.planning/**:
- Purpose: GSD planning documents
- Source: Created by /gsd commands
- Committed: Yes

---

*Structure analysis: 2026-02-04*
*Update when directory structure changes*
